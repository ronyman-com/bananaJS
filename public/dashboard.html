<!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>BananaJS Development Dashboard</title>
      <link rel="stylesheet" href="css/styles.css">
      <script src="https://cdn.tailwindcss.com"></script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.1.0/css/xterm.min.css">
      <script src="https://cdn.jsdelivr.net/npm/xterm@5.1.0/lib/xterm.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
      <script src="https://kit.fontawesome.com/af67804f51.js" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.7.0/lib/xterm-addon-fit.min.js"></script>
    </head>
    <body class="bg-gray-900 text-white">
      <div class="flex h-screen">
        <!-- Sidebar Navigation -->
        <div class="w-64 bg-gray-800 p-4 overflow-y-auto">
          <h1 class="text-xl font-bold text-yellow-400 mb-6">BananaJS</h1>
          <nav>
            <ul class="space-y-2">
              <li>
                <button data-action="dashboard" class="w-full text-left px-3 py-2 rounded bg-gray-700 hover:bg-gray-600 transition-colors">
                  <i class="fas fa-tachometer-alt mr-2"></i> Dashboard
                </button>

              </li>
              <li>
                <button data-action="show-file-manager" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                  <i class="fas fa-folder-open mr-2"></i> File Manager
                </button>
              </li>
              <li>
                <button onclick="window.appState.showTerminal()" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                  <i class="fas fa-terminal mr-2"></i> Terminal
                </button>
              </li>
              <li>
                <button onclick="window.appState.modalManager.openCreateProjectModal()" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                  <i class="fas fa-plus-circle mr-2"></i> New Project
                </button>
              </li>
              <li>
                <button onclick="window.appState.modalManager.openCreateAppModal()" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700 transition-colors">
                  <i class="fas fa-plus-circle mr-2"></i> New App
                </button>
              </li>
            </ul>
          </nav>

          <div class="mt-8 pt-4 border-t border-gray-700">
            <h3 class="text-sm font-semibold text-gray-400 mb-2">Quick Actions</h3>
            <button data-action="run-build" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700 text-sm transition-colors">
              <i class="fas fa-hammer mr-2"></i> Run Build
            </button>
            <button onclick="window.appState.restartServer()" class="w-full text-left px-3 py-2 rounded hover:bg-gray-700 text-sm transition-colors mt-1">
              <i class="fas fa-sync-alt mr-2"></i> Restart Server
            </button>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 overflow-auto">
          <!-- Dashboard Section -->
          <div id="dashboard-section" class="p-6">
            <div class="bg-gray-800 shadow rounded-lg p-6 mb-8">
              <h2 class="text-2xl font-bold text-yellow-400 mb-4">Development Dashboard</h2>

              <div id="connection-status" class="p-3 mb-4 rounded bg-yellow-100 text-yellow-800 flex items-center">
                <i class="fas fa-circle-notch fa-spin mr-2"></i>
                <span>Connecting to HMR server...</span>
              </div>

              <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-300 mb-2">Build Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div class="bg-gray-700 p-3 rounded">
                    <p class="text-sm text-gray-400">Last Build Time</p>
                    <p class="font-mono text-white" id="build-time">-- ms</p>
                  </div>
                  <div class="bg-gray-700 p-3 rounded">
                    <p class="text-sm text-gray-400">Last HMR Update</p>
                    <p class="font-mono text-white" id="hmr-update-time">-- ms</p>
                  </div>
                  <div class="bg-gray-700 p-3 rounded">
                    <p class="text-sm text-gray-400">Project Size</p>
                    <p class="font-mono text-white" id="project-size">--</p>
                  </div>
                  <div class="bg-gray-700 p-3 rounded">
                    <p class="text-sm text-gray-400">Files Count</p>
                    <p class="font-mono text-white" id="files-count">--</p>
                  </div>
                </div>
              </div>

              <div>
                <h3 class="text-lg font-semibold text-gray-300 mb-2">Recent Updates</h3>
                <ul class="space-y-2" id="hmr-updates-list"></ul>
              </div>
            </div>

            <div class="bg-gray-800 shadow rounded-lg p-6">
              <h3 class="text-lg font-semibold text-gray-300 mb-4">System Resources</h3>
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-gray-700 p-4 rounded-lg">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400">Memory Usage</span>
                    <span class="text-xs bg-blue-600 text-white px-2 py-1 rounded" id="memory-percent">0%</span>
                  </div>
                  <div class="w-full bg-gray-600 rounded-full h-2.5">
                    <div id="memory-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                  </div>
                  <p class="font-mono text-white text-sm mt-2" id="memory">0 MB / 0 MB</p>
                </div>

                <div class="bg-gray-700 p-4 rounded-lg">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400">CPU Usage</span>
                    <span class="text-xs bg-green-600 text-white px-2 py-1 rounded" id="cpu-percent">0%</span>
                  </div>
                  <div class="w-full bg-gray-600 rounded-full h-2.5">
                    <div id="cpu-bar" class="bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
                  </div>
                  <p class="font-mono text-white text-sm mt-2" id="cpu-cores">Cores: 0</p>
                </div>

                <div class="bg-gray-700 p-4 rounded-lg">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400">Disk Space</span>
                    <span class="text-xs bg-purple-600 text-white px-2 py-1 rounded" id="disk-percent">0%</span>
                  </div>
                  <div class="w-full bg-gray-600 rounded-full h-2.5">
                    <div id="disk-bar" class="bg-purple-600 h-2.5 rounded-full" style="width: 0%"></div>
                  </div>
                  <p class="font-mono text-white text-sm mt-2" id="disk-space">0 GB / 0 GB</p>
                </div>

                <div class="bg-gray-700 p-4 rounded-lg">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400">Network</span>
                    <span class="text-xs bg-yellow-600 text-white px-2 py-1 rounded">Active</span>
                  </div>
                  <div class="flex justify-between text-xs text-gray-400 mt-1">
                    <span>↑ <span id="network-up">0 KB/s</span></span>
                    <span>↓ <span id="network-down">0 KB/s</span></span>
                  </div>
                  <p class="font-mono text-white text-sm mt-2" id="network-status">Connected</p>
                </div>
              </div>
            </div>
          </div>

          <!-- File Manager Section -->
          <div id="file-manager-section" class="hidden p-6">
            <div class="bg-gray-800 shadow rounded-lg p-6 mb-8">
              <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-yellow-400">File Management</h2>
                <div>
                  <button onclick="window.appState.fileManager.refreshFileTree()" class="bg-yellow-400 text-gray-900 px-3 py-1 rounded text-sm font-bold hover:bg-yellow-500 transition mr-2">
                    <i class="fas fa-sync-alt mr-1"></i> Refresh
                  </button>
                  <button onclick="window.appState.modalManager.showCreateFileModal()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                    <i class="fas fa-file mr-1"></i> New File
                  </button>
                  <button onclick="window.appState.modalManager.showCreateFolderModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm ml-2">
                    <i class="fas fa-folder mr-1"></i> New Folder
                  </button>
                  <button onclick="window.appState.fileManager.uploadFile()" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm ml-2">
                    <i class="fas fa-upload mr-1"></i> Upload
                  </button>
                </div>
              </div>

              <div class="file-tree bg-gray-700 p-4 rounded">
                <div id="current-path" class="text-gray-400 mb-4 flex items-center">
                  <span>Current path: /</span>
                  <button onclick="window.appState.fileManager.copyCurrentPath()" class="ml-2 text-xs bg-gray-600 hover:bg-gray-700 text-white px-2 py-1 rounded transition">
                    <i class="fas fa-copy mr-1"></i> Copy Path
                  </button>
                </div>
                <ul id="file-tree" class="text-white"></ul>
              </div>
            </div>

            <!-- Editor Panel -->
            <div id="editor-container" class="bg-gray-800 rounded-lg shadow-lg hidden">
              <div class="bg-gray-900 p-3 flex justify-between items-center rounded-t-lg">
                <div class="flex items-center">
                  <span id="editor-filename" class="text-sm font-mono"></span>
                  <span id="editor-status" class="text-xs ml-2 px-2 py-1 rounded hidden"></span>
                </div>
                <div>
                  <button onclick="window.appState.editorManager.saveCurrentFile()" id="save-button" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm mr-2">
                    <i class="fas fa-save mr-1"></i> Save
                  </button>
                  <button onclick="window.appState.editorManager.closeEditor()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">
                    <i class="fas fa-times mr-1"></i> Close
                  </button>
                </div>
              </div>
              <div id="editor" style="height: calc(100vh - 150px);"></div>
            </div>
          </div>

          <!-- Terminal Section -->
          <div id="terminal-section" class="hidden p-6">
            <div class="bg-gray-800 shadow rounded-lg p-6">
              <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-yellow-400">Terminal</h2>
                <div>
                  <button id="clear-terminal" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm mr-2">
                    <i class="fas fa-broom mr-1"></i> Clear
                  </button>
                  <button id="run-start" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                    <i class="fas fa-play mr-1"></i> Start
                  </button>
                </div>
              </div>
              <!-- Remove the input field and just keep terminal container -->
              <div id="terminal" class="w-full h-96 bg-black rounded font-mono"></div>
            </div>
          </div>

      <!-- Modals -->
      <div id="modal-overlay" class="modal-overlay"></div>

      <div id="createProjectModal" class="modal">
        <h3 class="text-xl font-bold text-yellow-400 mb-4">Create Project</h3>
        <input type="text" id="projectName" placeholder="Enter project name"
               class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white focus:border-yellow-400 focus:outline-none">
        <div class="flex items-center mb-4">
          <input type="checkbox" id="initGit" class="mr-2">
          <label for="initGit">Initialize Git repository</label>
        </div>
        <div class="flex items-center mb-4">
          <input type="checkbox" id="useYarn" class="mr-2">
          <label for="useYarn">Use Yarn instead of npm</label>
        </div>
        <select id="projectTemplate" class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white focus:border-yellow-400 focus:outline-none">
          <option value="default">Default</option>
        </select>
        <div class="flex gap-2">
          <button onclick="window.appState.modalManager.createProjectWithCLI()" class="flex-1 bg-yellow-400 hover:bg-yellow-500 text-gray-900 py-2 rounded font-bold transition">
            <i class="fas fa-plus-circle mr-1"></i> Create Project
          </button>
          <button onclick="window.appState.modalManager.closeModal('createProjectModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded font-bold transition">
            <i class="fas fa-times mr-1"></i> Cancel
          </button>
        </div>
        <div id="cli-output" class="mt-4 p-3 bg-gray-800 rounded font-mono text-sm hidden max-h-40 overflow-y-auto"></div>
      </div>

      <div id="createAppModal" class="modal">
        <h3 class="text-xl font-bold text-yellow-400 mb-4">Create App</h3>
        <input type="text" id="appName" placeholder="Enter app name"
               class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white focus:border-yellow-400 focus:outline-none">
        <select id="appTemplate" class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white focus:border-yellow-400 focus:outline-none">
          <option value="react">Default</option>
          <option value="react">React</option>
          <option value="vue">Vue</option>
          <option value="firebase">Firebase</option>
          <option value="docs">Documentation</option>
        </select>
        <div class="flex gap-2">
          <button onclick="window.appState.modalManager.createApp()" class="flex-1 bg-yellow-400 hover:bg-yellow-500 text-gray-900 py-2 rounded font-bold transition">
            <i class="fas fa-plus-circle mr-1"></i> Create
          </button>
          <button onclick="window.appState.modalManager.closeModal('createAppModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded font-bold transition">
            <i class="fas fa-times mr-1"></i> Cancel
          </button>
        </div>
      </div>

      <!-- Create File Modal -->
      <div id="createFileModal" class="modal">
        <h3 class="text-xl font-bold text-yellow-400 mb-4">Create File</h3>
        <input type="text" id="fileName" placeholder="Enter file name"
               class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white focus:border-yellow-400 focus:outline-none">
        <select id="fileTemplate" class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white focus:border-yellow-400 focus:outline-none">
          <option value="empty">Empty File</option>
          <option value="javascript">JavaScript</option>
          <option value="typescript">TypeScript</option>
          <option value="react">React Component</option>
          <option value="html">HTML</option>
          <option value="css">CSS</option>
        </select>
        <textarea id="fileCustomContent" placeholder="Custom content (optional)"
                  class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white focus:border-yellow-400 focus:outline-none h-32"></textarea>
        <div class="flex gap-2">
          <button onclick="window.appState.fileManager.createNewFile()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded font-bold transition">
            <i class="fas fa-file mr-1"></i> Create File
          </button>
          <button onclick="window.appState.modalManager.closeModal('createFileModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded font-bold transition">
            <i class="fas fa-times mr-1"></i> Cancel
          </button>
        </div>
      </div>

      <!-- Create Folder Modal -->
      <div id="createFolderModal" class="modal">
        <h3 class="text-xl font-bold text-yellow-400 mb-4">Create Folder</h3>
        <input type="text" id="folderName" placeholder="Enter folder name"
               class="w-full p-2 mb-4 bg-gray-800 border border-gray-600 rounded text-white focus:border-yellow-400 focus:outline-none">
        <div class="flex gap-2">
          <button onclick="window.appState.fileManager.createNewFolder()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-bold transition">
            <i class="fas fa-folder mr-1"></i> Create Folder
          </button>
          <button onclick="window.appState.modalManager.closeModal('createFolderModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded font-bold transition">
            <i class="fas fa-times mr-1"></i> Cancel
          </button>
        </div>
      </div>

      <div id="uploadModal" class="modal">
        <h3 class="text-xl font-bold text-yellow-400 mb-4">Upload Files</h3>
        <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center mb-4">
          <input type="file" id="file-upload" class="hidden" multiple>
          <label for="file-upload" class="cursor-pointer">
            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
            <p class="text-gray-300">Drag & drop files here or click to browse</p>
            <p class="text-xs text-gray-500 mt-2">Max file size: 50MB</p>
          </label>
        </div>
        <div id="upload-progress" class="hidden">
          <div class="w-full bg-gray-600 rounded-full h-2.5 mb-2">
            <div id="upload-progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
          </div>
          <p class="text-xs text-gray-400 text-center" id="upload-status">Preparing to upload...</p>
        </div>
        <div class="flex gap-2">
          <button onclick="window.appState.fileManager.startUpload()" id="upload-button" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-2 rounded font-bold transition">
            <i class="fas fa-upload mr-1"></i> Upload
          </button>
          <button onclick="window.appState.modalManager.closeModal('uploadModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded font-bold transition">
            <i class="fas fa-times mr-1"></i> Cancel
          </button>
        </div>
      </div>

      <!-- Context Menu -->
      <div id="context-menu" class="context-menu">
        <div class="context-menu-item" onclick="window.appState.fileManager.contextMenuAction('open')">Open</div>
        <div class="context-menu-item" onclick="window.appState.fileManager.contextMenuAction('rename')">Rename</div>
        <div class="context-menu-item" onclick="window.appState.fileManager.contextMenuAction('delete')">Delete</div>
        <div class="context-menu-item" onclick="window.appState.fileManager.contextMenuAction('download')">Download</div>
        <div class="context-menu-item" onclick="window.appState.fileManager.contextMenuAction('copy-path')">Copy Path</div>
      </div>

     <!-- Load utility/helper files first -->
    <!-- Core utilities first -->
<script type="module" src="js/utils.js"></script>
<script type="module" src="js/notifications.js"></script>
<script type="module" src="js/modals.js"></script>

<!-- Then state management -->
<script type="module" src="js/app-state.js"></script>

<!-- Then features -->
<script type="module" src="js/websocket-manager.js"></script>
<script type="module" src="js/terminal.js"></script>
<script type="module" src="js/editor.js"></script>
<script type="module" src="js/file-manager.js"></script>

<!-- Initialization last -->
<script type="module" src="js/app-init.js"></script>

<!-- Load Monaco only when needed -->
<script>
  function loadMonaco() {
    return new Promise((resolve) => {
      if (window.monaco) return resolve();
      require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
      require(['vs/editor/editor.main'], resolve);
    });
  }

  window.addEventListener('error', (event) => {
  console.error('Global error:', event.error);
  if (window.appState?.notificationManager) {
    window.appState.notificationManager.showNotification(
      `App error: ${event.error.message}`,
      'error'
    );
  }
});

window.addEventListener('unhandledrejection', (event) => {
  console.error('Unhandled rejection:', event.reason);
  event.preventDefault();
});

  </script>

  <!-- Update your script loading at the bottom of the HTML -->
  <script type="module">
    import { AppState } from './js/app-state.js';
    import { FileManager } from './js/file-manager.js';
    import { ModalManager } from './js/modals.js';
    import { TerminalManager } from './js/terminal.js';
    import { EditorManager } from './js/editor.js';
    import { NotificationManager } from './js/notifications.js';
  
    async function initApp() {
      // Create appState first
      window.appState = new AppState();
      
      // Initialize core managers
      window.appState.notificationManager = new NotificationManager();
      window.appState.modalManager = new ModalManager(window.appState);
      
      // Then initialize others that depend on them
      window.appState.fileManager = new FileManager(window.appState);
      window.appState.terminalManager = new TerminalManager(window.appState);
      window.appState.editorManager = new EditorManager(window.appState);
      
      // Final initialization
      await window.appState.init();
      
      // Load initial view
      window.appState.fileManager.loadFileTree();
    }
  
    // Start the app when DOM is ready
    document.addEventListener('DOMContentLoaded', initApp);
  </script>


<script>
  document.addEventListener('DOMContentLoaded', function() {
      const terminalManager = {
          clearTerminal: function() {
              document.getElementById('terminal').innerHTML = '';
          },
          runCommand: function(command) {
              console.log('Running command:', command);
              // Add your terminal logic here
          },
          sendTerminalCommand: function() {
              const input = document.getElementById('terminal-input');
              const command = input.value.trim();
              if (command) {
                  this.runCommand(command);
                  input.value = '';
              }
          }
      };
  
      document.getElementById('clear-terminal').addEventListener('click', () => {
          terminalManager.clearTerminal();
      });
      
      document.getElementById('run-start').addEventListener('click', () => {
          terminalManager.runCommand('npm start');
      });
      
      // Add other event listeners as needed
  });
  </script>
  <!-- In your dashboard.html -->
<script type="module">
  import { Terminal } from 'https://cdn.jsdelivr.net/npm/xterm@5.1.0/lib/xterm.min.js';
  import { FitAddon } from 'https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.5.0/lib/xterm-addon-fit.min.js';
  import { TerminalManager } from './js/terminal.js';

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', async () => {
    if (!window.appState) {
      console.error('appState not initialized');
      return;
    }

    // Initialize terminal manager
    window.appState.terminalManager = new TerminalManager(window.appState);
    
    // Show terminal when button clicked
    document.querySelector('[onclick="window.appState.showTerminal()"]')
      .addEventListener('click', async () => {
        await window.appState.terminalManager.init();
        document.getElementById('terminal-section').classList.remove('hidden');
      });
  });
</script>
<script>
  // Load xterm using traditional script tags
  function loadScript(src) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = src;
      script.onload = resolve;
      script.onerror = reject;
      document.head.appendChild(script);
    });
  }

  Promise.all([
    loadScript('https://cdn.jsdelivr.net/npm/xterm@5.1.0/lib/xterm.min.js'),
    loadScript('https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.5.0/lib/xterm-addon-fit.min.js')
  ]).then(() => {
    class TerminalManager {
      constructor(appState) {
        this.appState = appState;
        this.terminal = new Terminal({
          cursorBlink: true,
          theme: {
            background: '#1a1a1a',
            foreground: '#ffffff'
          }
        });
        this.fitAddon = new FitAddon();
        this.terminal.loadAddon(this.fitAddon);
      }

      init() {
        const terminalEl = document.getElementById('terminal');
        if (!terminalEl) {
          console.error('Terminal element not found');
          return;
        }
        
        this.terminal.open(terminalEl);
        this.fitAddon.fit();
        
        this.setupEventListeners();
        this.terminal.writeln('Terminal ready');
      }

      // ... rest of your TerminalManager implementation ...
    }

    // Initialize when ready
    document.addEventListener('DOMContentLoaded', () => {
      if (!window.appState) {
        console.error('appState not initialized');
        return;
      }
      
      window.appState.terminalManager = new TerminalManager(window.appState);
    });
  }).catch(error => {
    console.error('Failed to load terminal scripts:', error);
  });
</script>
    </body>
    </html>
